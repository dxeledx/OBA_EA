# 2025-12-23 — 2-class vs 4-class “safe” runs (with per-trial predictions CSV)

This note records two representative runs after:
- adding per-trial prediction exports (`*_predictions.csv`), and
- organizing outputs by task (`outputs/YYYYMMDD/2class/...` vs `outputs/YYYYMMDD/4class/...`).

## 2-class (left vs right) — MOABB preprocessing, CSP=4

Command:
```bash
conda run -n eeg python run_csp_lda_loso.py \
  --events left_hand,right_hand --sessions 0train \
  --preprocess moabb --n-components 4 \
  --oea-q-blend 0.3 --oea-pseudo-iters 0 \
  --oea-zo-iters 50 --oea-zo-k 20 --oea-zo-lr 0.3 --oea-zo-mu 0.05 \
  --oea-zo-holdout-fraction 0.3 --oea-zo-trust-lambda 0.05 --oea-zo-trust-q0 identity \
  --oea-pseudo-confidence 0.7 --oea-pseudo-topk-per-class 40 --oea-pseudo-balance \
  --methods ea-csp-lda,oea-csp-lda,oea-zo-im-csp-lda \
  --run-name 2c_moabb_csp4_q03_safe
```

Outputs:
- `outputs/20251223/2class/2c_moabb_csp4_q03_safe/20251223_results.txt`
- `outputs/20251223/2class/2c_moabb_csp4_q03_safe/20251223_predictions_all_methods.csv`

Key result (mean LOSO accuracy):
- EA (`ea-csp-lda`): **0.6983**
- OEA-Δ strict (`oea-csp-lda`, `--oea-pseudo-iters 0`): **0.7099**  (Δ vs EA: **+1.16%** abs)
- OEA-ZO-IM (`oea-zo-im-csp-lda`): **0.7091** (close to OEA-Δ here)

## 4-class (left/right/feet/tongue) — paper FIR, CSP=6

Command:
```bash
conda run -n eeg python run_csp_lda_loso.py \
  --events left_hand,right_hand,feet,tongue --sessions 0train \
  --preprocess paper_fir --n-components 6 \
  --oea-q-blend 0.3 \
  --oea-zo-iters 50 --oea-zo-k 20 --oea-zo-lr 0.3 --oea-zo-mu 0.05 \
  --oea-zo-holdout-fraction 0.3 --oea-zo-trust-lambda 0.1 --oea-zo-trust-q0 identity \
  --oea-zo-reliable-metric confidence --oea-zo-reliable-threshold 0.7 --oea-zo-reliable-alpha 10 \
  --oea-zo-marginal-mode kl_prior --oea-zo-marginal-prior anchor_pred --oea-zo-marginal-prior-mix 0.2 --oea-zo-marginal-beta 0.5 \
  --methods ea-csp-lda,ea-zo-im-csp-lda \
  --run-name 4c_paperfir_csp6_im_prior_anchor
```

Outputs:
- `outputs/20251223/4class/4c_paperfir_csp6_im_prior_anchor/20251223_results.txt`
- `outputs/20251223/4class/4c_paperfir_csp6_im_prior_anchor/20251223_predictions_all_methods.csv`

Key result (mean LOSO accuracy):
- EA (`ea-csp-lda`): **0.5320**
- EA-ZO-IM (`ea-zo-im-csp-lda`): **0.5320** (no net gain in this setting)

Observation:
- With the current “safe” settings (holdout + trust + reliability weighting + prior-marginal penalty), the selector often chooses **identity** (EA) and gains are small on 4-class.
- 2-class still shows a consistent improvement for **OEA-Δ strict** vs EA in this configuration.

